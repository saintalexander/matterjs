<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Text Shape Simulation</title>
<meta name="description" content="Using Matter.js for Text Rendering">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="css/style.css">   
<script>
!function(){const e="dark"===localStorage.getItem("theme");document.documentElement.classList.toggle("dark-theme",e),document.addEventListener("DOMContentLoaded",function(){document.querySelector(".btn-toggle").addEventListener("click",function(){localStorage.setItem("theme",document.documentElement.classList.toggle("dark-theme")?"dark":"light")})})}();
</script>
<style>
html.dark-theme body {--bkg:#fff;--text:#000;background:var(--bkg);color:var(--text)}
@media only screen and (max-width: 800px){#fontsbundel{margin-top:-400px}}    
@media only screen and (min-width: 800px){#fontsbundel{margin-top:-9vw}}    
</style>
</head>
<body>    
<div id="menu">
    <!-- Navigation and other content here -->
</div>

<div id="fontsbundel"></div> <!-- Canvas will be here -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script>
// Matter.js setup
const {Engine, Render, World, Bodies, Mouse, MouseConstraint, Composites, Body, Events} = Matter,
engine = Engine.create(),
world = engine.world,
width = window.innerWidth,
height = window.innerHeight,
render = Render.create({
    element: document.querySelector("#fontsbundel"),
    engine: engine,
    options: {
        width: width,
        height: height,
        wireframes: false,
        background: "transparent",
        hasBounds: false,
        pixelRatio: window.devicePixelRatio
    }
});
render.canvas.id = "fontsCanvas";

// Adjust generalScale based on screen width
let generalScale = width >= 2400 ? 0.30 :
                   width >= 2000 ? 0.28 :
                   width >= 1800 ? 0.26 :
                   width >= 1600 ? 0.24 :
                   width >= 1200 ? 0.22 : 
                   width >= 900 ? 0.20 : 0.18;

// List of words to display instead of images
const wordList = [
    "Webbutveckling", 
    "Filmproduktion", 
    "Grafisk design", 
    "VarumÃ¤rkesplatform", 
    "Illustration"
];

// Function to create text-based body
const createTextBody = function(x, y, text) {
    const textWidth = text.length * 15;  // Approximate width based on text length
    const body = Bodies.rectangle(x, y, textWidth, 50, {
        render: {
            fillStyle: "transparent",  // Invisible rectangle background
            strokeStyle: "transparent", // No border
            text: {
                content: text,
                fontSize: 18,
                color: "#000",
                fontFamily: "sans-serif"
            }
        }
    });
    return body;
};

// Create the text bodies
const textBodies = Composites.stack(10, 10, wordList.length, 1, 20, 20, (x, y, column, row) => {
    return createTextBody(x, y, wordList[column % wordList.length]);
});
World.add(world, textBodies);

// Walls to contain the text bodies within the canvas
const walls = [
    Bodies.rectangle(width / 2, 0, width, 40, {isStatic: true, render: {fillStyle: "rgba(0, 0, 0, 0)"}}),
    Bodies.rectangle(width / 2, height, width, 20, {isStatic: true, render: {fillStyle: "rgba(0, 0, 0, 0)"}}),
    Bodies.rectangle(width, height / 2, 40, height, {isStatic: true, render: {fillStyle: "rgba(0, 0, 0, 0)"}}),
    Bodies.rectangle(0, height / 2, 60, height, {isStatic: true, render: {fillStyle: "rgba(0, 0, 0, 0)"}})
];
World.add(world, walls);

// Mouse control for interacting with the text
const mouse = Mouse.create(render.canvas),
mouseConstraint = MouseConstraint.create(engine, {
    mouse: mouse,
    constraint: {render: {visible: false}}
});
World.add(world, mouseConstraint);
render.mouse = mouse;

// Run the Matter.js engine
Matter.Runner.run(engine);
Render.run(render);

// Custom render loop to draw text on the canvas
(function customRender() {
    const bodies = Matter.Composite.allBodies(world);
    const ctx = render.context;
    ctx.clearRect(0, 0, render.options.width, render.options.height);  // Clear canvas

    // Loop through each body and render the text
    for (const body of bodies) {
        if (body.render.text) {
            const { content, fontSize, color, fontFamily } = body.render.text;
            ctx.font = `${fontSize}px ${fontFamily}`;
            ctx.fillStyle = color;
            const textWidth = ctx.measureText(content).width;
            ctx.fillText(content, body.position.x - textWidth / 2, body.position.y + fontSize / 2);
        }
    }

    requestAnimationFrame(customRender);
})();
</script>
</body>
</html>
